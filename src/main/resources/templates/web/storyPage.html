<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
    <title th:text="${title}"></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <th:block th:include="web/layout :: head"></th:block>
    <script th:src="@{/js/jRating.js}"></script>
</head>
<body ng-app="ngApp" ng-controller="storyController" th:ng-init="|sid='${story.sID}'|">
<th:block th:include="web/layout :: loading"></th:block>
<section class="page-wrapper">
    <th:block th:include="web/layout :: navbar"></th:block>
    <section class="truyen-main">
        <section class="container">
            <section class="truyen-detail-block">
                <section class="truyen-section section-featured">
                    <section class="featured-content truyen-breadcrumb p-0">
                        <ol class="breadcrumb" style="background-color: inherit">
                            <li class="breadcrumb-item">
                                <a property="item" typeof="WebPage" th:href="@{/}">
                                    <span property="name">Trang chủ</span>
                                </a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page"
                                th:text="${story.getvnName()}">
                            </li>
                        </ol>
                    </section>
                </section>
                <section class="truyen-section section-featured section-detail-info">
                    <div class="truyen-detail-info-block">
                        <div class="row">
                            <div class="col-thumb col-3">
                                <div class="thumb hidden-xs">
                                    <img class="img-fluid lazyload" th:data-src="${story.sImages}">
                                </div>
                            </div>
                            <div class="col-info col-6">
                                <div class="info">
                                    <h1 class="title">
                                        <a href="" th:title="${story.getvnName()}" th:text="${story.getvnName()}"></a>
                                    </h1>
                                    <div class="list">
                                        <div class="item">
                                            <div class="item-label"> Tác giả:</div>
                                            <div class="item-value"><span
                                                    class="author" th:text="${story.sAuthor}"></span></div>
                                        </div>
                                        <div class="item">
                                            <div class="item-label"> Thể loại:</div>
                                            <div class="item-value">
                                                <ul class="list-unstyled categories">
                                                    <li th:each="category : ${story.categoryList}">
                                                        <a th:href="@{'/the-loai/'+${category.cID}+'/'+${category.cMetatitle}}"
                                                           th:title="'Truyện'+${category.cName}"
                                                           th:text="${category.cName}"></a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="item">
                                            <div class="item-label"> Tình trạng:</div>
                                            <div class="item-value">
                                                <span class="story-go text-center" th:if="${story.sStatus==1}">
                                                    Đang ra
                                                </span>
                                                <a class="story-status text-center" th:if="${story.sStatus==2}">
                                                    Hoàn Thành
                                                </a>
                                            </div>
                                        </div>
                                        <div class="item d-block d-sm-none">
                                            <div class="item-label"> Đã đọc:</div>
                                            <div class="item-value"><a
                                                    href="https://truyen.com/van-kiem-thanh-de/chuong-517/">Chương
                                                518: Kiếm Ý</a></div>
                                        </div>
                                        <div class="item d-block d-sm-none">
                                            <div class="item-label"> Mới nhất:</div>
                                            <div class="item-value"><a
                                                    href="https://truyen.com/van-kiem-thanh-de/chuong-1093/"><span
                                                    class="text-info">Chương 1108: Một cái quyết định</span></a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="buttons">
                                        <a href="https://truyen.com/van-kiem-thanh-de/chuong-517/"
                                           class="btn btn-truyen">Đọc tiếp</a>
                                        <a href="javascript:void(0)" onclick="registRecentReadingStory(20569,1)"
                                           class="btn btn-truyen-white" id="btnregistRecentReadingStory">Theo
                                            dõi</a>
                                    </div>
                                </div>
                            </div>

                            <div class="col-rating col-3">
                                <div class="rating-container text-center" itemscope="">
                                    <div class="title"> Đánh giá</div>
                                    <div class="content" itemprop="aggregateRating" itemscope="">
                                        <div class="message"> Đã có
                                            <span itemprop="ratingCount" id="myrating" th:text="${countRating}"></span>
                                            người đánh giá
                                        </div>
                                        <div class="star-total hidden-xs">
                                            <span id="myrate" itemprop="ratingValue"
                                                  th:text="${#numbers.formatDecimal(story.sRating, 0, T(Math).round(story.sRating) == story.sRating ? 0 : 1,'POINT')}"></span>
                                        </div>
                                        <div class="basic" th:data-average="${story.sRating}" th:data-id="${story.sID}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="truyen-section">
                    <section class="truyen-detail-tab" id="navbar-custom">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs nav-custom" role="tablist">
                            <li class="nav-item active">
                                <a class="nav-link active" data-toggle="tab" href="#truyen-info"
                                   role="tab">
                                    Giới Thiệu
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#truyen-chapter" role="tab"
                                   ng-click="getListChapter(1, 1)">
                                    <!--th:ng-click="|getListChapter(${story.sID},1,1)|">-->
                                    Danh Sách Chương
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#truyen-comment" role="tab"
                                   ng-click="getListComment(1, 1)">
                                    Bình Luận
                                </a>
                            </li>
                        </ul>
                        <!-- Tab panes {Fade}  -->
                        <section class="tab-content">
                            <section class="tab-pane fade show active" id="truyen-info"
                                     name="truyen-detail-info" role="tabpanel">
                                <section class="row">
                                    <section class="col-sm-12 col-md-4 col-lg-3">
                                        <div class="truyen-detail-sidebar">
                                            <div class="block block-normal">
                                                <div class="block-content">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="block-detail-sidebar-author text-center">

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                    <section class="col-sm-12 col-md-8 col-lg-9">
                                        <div class="alert alert-primary" role="alert">

                                        </div>
                                    </section>
                                </section>
                            </section>
                            <section class="tab-pane fade" id="truyen-chapter" name="truyen-chapter" role="tabpanel">
                                <section class="truyen-detail-chap">
                                    <th:block th:include="web/listLayout :: chapterOfStory"></th:block>
                                </section>
                            </section>
                            <section class="tab-pane fade" id="truyen-comment" name="truyen-comment" role="tabpanel">
                                <section class="truyen-detail-chap">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <th:block th:include="web/listLayout :: commentOfStory"></th:block>
                                        </div>
                                    </div>
                                </section>
                            </section>
                        </section>
                    </section>
                </section>
            </section>
        </section>
    </section>
    <th:block th:include="web/layout :: footer"></th:block>
</section>
<script>
    $(document).ready(function () {
        $(".basic").jRating({
            decimalLength: 0,
            phpPath: window.location.origin + '/api/rating',
            bigStarsPath: window.location.origin + '/images/stars.png',
            rateMax: 10,
            onSuccess: function (element, rate, data) {
                if (data.message)
                    swal({
                        text: data.message,
                        type: 'warning',
                        confirmButtonText: 'Ok'
                    });
                else {
                    $('#myrating').html(data.myrating);
                    $('#myrate').html(data.myrate);
                }
            },
            onError: function () {
                alert('Error : please retry');
            }
        });
    });
</script>
</body>
</html>